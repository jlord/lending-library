<!doctype html>
	<html class="no-js" lang="en">
		<title>Tool Lending</title>
		<meta charset='utf-8'>
		<script type="text/javascript" src="js/ICanHaz.js"></script>
		<script src='js/jquery.js'></script>
		<script type="text/javascript" src='js/sheetsee.js'></script>
		<script type="text/javascript" src='js/data.js'></script>
		<link rel="shortcut icon" href="https://raw.github.com/jllord/sheetsee-cache/master/favicon-p.png"/>
		<link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,400,600,700,900' rel='stylesheet' type='text/css'>
		<link media="screen" rel="stylesheet" type="text/css" href="css/site.css">
	</head>
	<body>
		<header class="container">
			<h1>Tool Lending</h1>
			<ul class="nav">
				<li><strong>LENDING IS LOVELY</strong></li>
				<li>AN OPEN SOURCE, EASY TO DUPLICATE PROJECT</li>
				<li><a href="#info">HERE'S HOW</a></li>
			</ul>
		</header>
		<div id="filters" class="container">
			<input id="toolSearch" type="text" placeholder="hammer.."></input>
			<span class="clear sml-button">Clear</span>
			<span id="showAvailable" class="sml-button">Show Available</span>
		</div>
		<div id="tools" class="container"></div>
		<div id="info" class="container">
				<div class="span1">
					<h4>USE THIS</h4>
					<p>If you've been invited by the person who initated this near you, you'll have access and the ability to edit the rows. Simply add the rows for the tools you have and add yes if an item is currently being borrowed. Easy, the Spreadsheet auto-saves, too!</p>

					<h4>OPEN SOURCE PROJECT</h4>
					<p>The design and code for this website is open source on <a href="http://www.github.com" target="_blank">GitHub</a>, that means free for anyone to use. The data fueling this website is managed free and easily through a <a href="http://drive.doogle.com" target="_blank">Google Spreadsheet</a> that looks similar <a href="https://docs.google.com/spreadsheet/ccc?key=0AvFUWxii39gXdGxhcjhzYzlBX2pyVFZZU2VjZ3BHZ3c&usp=sharing" target="_blank">to this one</a>.</p>
				</div>

				<div class="span1">
					<h4>START YOUR OWN</h4>
					<p>The site can be duplicated and live in minutes. It is an <a href="http://www.github.com/jlord/sheetsee-tool-lending" target="_blank">open source project</a> on GitHub, which hosts webpages for projects for free with <a href="http://pages.github.com" target="_blank">GitHub Pages</a>. All you need to do is <strong>fork</strong> the project to your account (also free) and copy and paste in your spreadsheet's unique key. More details are available on the <a href="http://www.github.com/jlord/sheetsee-tool-lending#hi" target="_blank">readme</a>.</p>

					<p>Jessica Lord built this. Contact via <a href="mailto:to.jlord@gmail.com">email</a>, <a href="http://www.twitter.com/jllord">tweet</a> or <a href="http://www.github.com/jlord" target="_blank">pull request</a>.

				</div>
		</div>

		<script id="tools" type="text/html">
		{{#rows}}
		<div id="{{rowNumber}}" class="tool-box {{^checkedout}}available{{/checkedout}}">
			<span class="tool-box-tool">{{tool}}</span>
			<div class="tool-box-bottom {{rowNumber}}">
				{{#checkedout}} <span class="tool-box-borrowed">ON LOAN</span>{{/checkedout}}
				{{^checkedout}}<a href="mailto:{{owneremail}}?subject=Tool Lending: {{tool}}"><span class="tool-box-borrow btn">BORROW</span></a>{{/checkedout}}
				<ul>
					<li><small>WHO / WHERE : </small></li>
					<li><a href="mailto:{{owneremail}}">{{owner}}</a></li>
					<li>{{street}}, {{city}}, {{state}}</li>
					<li><a href="https://maps.google.com/maps?q={{street}},{{city}},{{state}}" target="_blank"><small>MAP</small></a></li>
					{{#tooldetails}}
					<li><small>NOTES : </small>{{tooldetails}}</li>
					{{/tooldetails}}
				</ul>
			</div>
		</div>
		{{/rows}}
		</script>

		<script type="text/javascript">
	  document.addEventListener('DOMContentLoaded', function() {
	  	// original tool boxes
	  	console.log(gData.length)
	  	drawToolBox(gData)
	  })

  	function drawToolBox(data) {
  		var tools = ich.tools({
  			"rows": data
  		})
  		$('#tools').html(tools)
  	}

		// toggle available/all tools with search as well
		$('#showAvailable').live("click", function(event) {
			var searchValue = $('#toolSearch').val()
			if ($(this).hasClass('button-pressed')) {
				console.log("UNPRESSED")
				$(this).removeClass('button-pressed').removeClass('onlyAvailable').html('Show Available')
				if (!searchValue) return $('.tool-box').show() // drawToolBox(gData)
				toolsFromSearch(searchValue)
			}
			else {
				$(this).addClass('button-pressed').addClass('onlyAvailable').html('Show All')
				if (!searchValue) {
					console.log("PRESSED, NO SEARCH VALUE")
					// var availableTools = Sheetsee.getMatches(gData,"yes", "checkedout")
					// console.log($('.tool-box').length)
					// drawToolBox(availableTools)
					$('.tool-box').not('.available').hide()
				}
				else {
					console.log("PRESSED, SEARCH VALUE")
					// var searchResults = Sheetsee.getKeyword(gData, searchValue)
					// var availableFromSearch = Sheetsee.getMatches(searchResults,"", "checkedout")
					// console.log(availableFromSearch)
					// drawToolBox(availableFromSearch)
					// // $('.tool-box').filter('.available').hide()
					$('.tool-box').not('.available').hide()
				}
			}
		})

	  // toggle tool box expand
	  $('.tool-box-tool').live("click", function(event) {
   		var rowNumber = $(this).closest("div").attr("id")
   		if ($(this).closest('div').hasClass('selected-tool')) {
   			$('.tool-box-bottom' + '.' + rowNumber).css('display', 'none')
   			$(this).closest('div').removeClass('selected-tool')
   		}
   		else {
   			$('.tool-box-bottom' + '.' + rowNumber).css('display', 'inherit')
   			$(this).closest('div').addClass('selected-tool')
   		}
   	})
   	// filter input
	  $('.clear').on("click", function() {
	    $(this.id + "#toolSearch").val("")
	    drawToolBox(gData)
	  })

    $('#toolSearch').keyup(function(e) {
    	var text = $(e.target).val()
    	if (text === "") return drawToolBox(gData)
	
			if ($('.button-pressed').length === 1) {
				console.log("Hide unavailable")
				$('.tool-box').not('.available').hide()
			}

			return toolsFromSearch(text)
			// $('.tool-box-tool').filter(function() {
			// 	// console.log(this)
			// 	if ($(this).html().match(text)) {
			// 		console.log("match", $(this).html())
			// 		return $(this).parent().show()
			// 	} else {
			// 		return $(this).parent().hide()
			// 	}
			// 	return this.innerHTML.match()
			// })
  	})

		function toolsFromSearch(searchTerm) {
			$('.tool-box-tool').not(function() {
				return $(this).html().match(searchTerm)
			}).parent().hide()
			// var searchedData = Sheetsee.getMatches(gData, searchTerm, "tool")
			// console.log(searchedData.length)
			// return drawToolBox(searchedData)
		}
		</script>
	</body>
</html>
